---
title: 一个值得玩味的 bug
date: 2015-08-28 23:47:42
permalink: 1440776862271
tags: 算法
---

最近在看[SICP](http://book.douban.com/subject/1148282/)这本书时，发现书中2.1.4节讨论的区间算术很有启发性，问题的描述大概是这样的（这里没有按书上的方式来写）：

我们在现实中测量任何物理量时，一般得到的都不是一个确定的值，而是需要多次测量得到平均值和均方差，一般记录为(x ± dx)。这种记录形式也可以用区间来表示[a, b] = [x - dx, x+ dx]。接下来，我们需要定义一套算术规则来对这个区间进行一些计算，因为我们通常需要将这些直接测量量代入表达式进行计算，来得到一些间接测量量的平均值和误差。

接下来，用面向对象程序设计的思维，我们将这个区间封装为一个对象，用大写字母表示，例如X = [a, b], Y = [c, d]，接下来可以根据下面的运算规则，添加一些用于区间对象的方法，实现区间的四则运算：

![+](https://upload.wikimedia.org/math/a/b/8/ab8eff239d0bc10a228b527bef521980.png)
![-](https://upload.wikimedia.org/math/c/b/1/cb14ca81ded2e95ec5ae0e22adfddad5.png)
![*](https://upload.wikimedia.org/math/b/7/e/b7ec58930a5535926a76c1a2563812a1.png)
![/](https://upload.wikimedia.org/math/7/7/8/778845f0c9f6fc78fb2f91288afcd096.png)

这样，我们可以很方便的进行一些误差分析，例如用于并联电阻的计算：

假设R1 = [10, 20], R2 = [4, 5], 我们可以代入并联电阻的计算公式得到：

    并联电阻 = 1 / ((1 / R1) + (1 / R2)) = [2.86, 4]

但如果我们采用另外一种等价的表达式进行计算：

    并联电阻 = (R1 * R2) / (R1 + R2) = [1.6, 7.14]

我们发现两种等价表达式计算的结果竟然不同，后者的区间范围更大。问题出在哪呢？

有人可能会认为某些运算规则上出了问题，例如：你可以验证乘法分配律A(B + C) = AB + AC是不适用于区间的。但实际上，我们之前定义的四则运算除了加法，都存在bug：A - A的值不恒等于0，A / A的值不恒等于1，当A区间跨越0时，A * A的区间下限不恒等于0。难道区间的四则运算定义是错误的？如果是的，那么针对这些特殊情况增添一些规则，给它打个补丁，是否问题就解决了呢？

其实，前面这些bug的根源并不是运算规则，而是运算的各个区间对象之间存在依赖性，依赖性会增加约束条件，而程序计算过程中忽略了这些约束条件。这种依赖性从物理的角度上来说是很容易理解的：虽然A的取值可以是在一个区间内的，但对于单次测量，A的值是确定的，因此表达式中如果出现多次A的话，就需要额外小心，这些A不是相互孤立的。同样的，依赖性也可以是两个不同的物理量之间的，例如2*A恒等于B，那么在同一个表达式中，A和B即使都只出现一次，也存在依赖性这个问题。还有类似sin(x)这些非线性函数，x看似只出现了一次，没有依赖性问题，但它不是基本操作，我们需要对它作泰勒级数展开，变换成多项式求和，这时你会发现又处处是陷阱。

前面计算并联电阻时，前者是正确的，因为前者R1和R2在表达式中都只出现了一次，两者也是相互孤立的，因此没有依赖性问题；后者计算结果的区间范围比前者大也是可以理解的：后者缺少约束条件，所以代入的某些区间的范围比正确的区间范围更大，因此最终结果的区间范围也比正确的更大。

如果考虑了这种依赖性之后，我们是否就能设计出一套完备的体系了呢？从数值计算的角度来说是可以的，这个问题等价于求一个多元函数在某个区间内的最小值和最大值，有很多算法可以解决这个问题，我们可以绕开区间算术。但从数学的角度来说要设计一套完备的区间算术，个人觉得很难，我没有精力继续深究下去了，这个已经超越程序设计的范畴了。如果能设计出来，这套体系会是简洁优雅的吗？

这个链接是有关区间算术的介绍： [Interval Computations](http://www.cs.utep.edu/interval-comp/main.html)，有兴趣的可以继续深入了解。

在这个看似简单的问题里，我们可以感受到数学，物理和程序设计三者在这里交汇。程序设计的本质是对现实世界的一种抽象，让现实世界变得“可以计算”，但这种抽象的能力还是有限的，在这个问题里我们抽象了区间以及它的四则运算，但如何抽象依赖性呢？更有意思的问题是如何抽象人脑，创造真正的人工智能呢？而对于数学，在这里也离不开物理，前面谈到的依赖性是基于现实世界的需求的，从数学的层面讲，这种依赖性不是必要的，我们可以抛开这些枷锁，说在这套体系里A - A就是不恒等于0，A / A就是不恒等于1，也没有乘法分配律，但这样的体系有什么实际用处呢？区间算术是因为现实世界的需要而建立的，所以这套体系自然应当是适用于现实世界的。